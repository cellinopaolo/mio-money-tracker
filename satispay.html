<div class="mx-4 mt-10 pb-10">
    <h3 class="text-[10px] font-black text-gray-400 uppercase tracking-widest text-center mb-4">Storico Caricamenti Buoni</h3>
    <div id="voucherHistory" class="space-y-2">
        </div>
</div>

<script>
// Aggiorna la funzione loadSatispay per includere lo storico
async function loadSatispay() {
    // 1. Recupera ricariche dal wallet
    const { data: wallet } = await supabaseClient
        .from('voucher_wallet')
        .select('*')
        .order('data_caricamento', { ascending: false });
    
    const totaleBuoniCaricati = wallet?.reduce((sum, w) => sum + w.quantita_caricata, 0) || 0;
    const budgetTotaleEuro = totaleBuoniCaricati * VALORE_SINGOLO_BUONO;

    // ... (restante logica delle transazioni uguale a prima) ...

    // 4. Renderizza lo storico dei caricamenti
    let historyHtml = '';
    wallet?.forEach(w => {
        historyHtml += `
        <div class="flex justify-between items-center bg-slate-100 p-3 rounded-xl border border-slate-200">
            <div>
                <p class="text-[10px] font-bold text-slate-700">Caricati €${(w.quantita_caricata * 6).toFixed(2)}</p>
                <p class="text-[8px] text-slate-400 uppercase font-medium">${w.data_caricamento}</p>
            </div>
            <button onclick="deleteVoucherLoad(${w.id})" class="text-rose-400 p-2">✕</button>
        </div>`;
    });
    document.getElementById('voucherHistory').innerHTML = historyHtml || '<p class="text-center text-slate-300 text-[10px]">Nessun caricamento registrato</p>';
}

// Nuova funzione per eliminare un caricamento errato
async function deleteVoucherLoad(id) {
    if(confirm("Vuoi eliminare questo caricamento? Il saldo buoni verrà ricalcolato.")) {
        const { error } = await supabaseClient
            .from('voucher_wallet')
            .delete()
            .eq('id', id);
        
        if(!error) loadSatispay();
    }
}
</script>
